# 业务逻辑错误

> 业务逻辑错误，也称为业务逻辑漏洞，是一种应用程序漏洞，源于应用程序的业务逻辑。这部分程序负责处理现实世界的商业规则和流程。这些规则可能包括定价模型、交易限制或在多步骤过程中需要遵循的操作顺序。

## 摘要

- 示例
- 参考资料

## 示例

与其他类型的安全漏洞（如SQL注入或跨站脚本（XSS））不同，业务逻辑错误不依赖于代码本身的缺陷（如未过滤的用户输入）。相反，它们利用应用程序的正常预期功能，采用开发者未曾预料到的方式，导致意外后果。

### 常见业务逻辑错误示例

- **审查功能测试**
  - 评估是否能在未购买商品的情况下，以验证买家的身份发布商品评论。
  - 尝试在1到5的评分系统中给出超出范围的评分，比如0分、6分或负数。
  - 测试同一用户是否能为同一商品发布多条评价。这有助于发现潜在的竞态条件问题。
  - 确认文件上传功能是否允许所有文件扩展名；开发者有时会忽略对这些端点的保护。
  - 调查是否有冒充其他用户的评论发布可能性。
  - 对该功能尝试跨站请求伪造（CSRF），因为这些功能往往缺乏令牌保护。
- **折扣码功能测试**
  - 尝试多次使用同一个折扣码，评估其是否可以重复使用。
  - 如果折扣码具有唯一性，通过同时向两个账户应用相同折扣码来检测竞态条件。
  - 测试是否存在批量赋值或HTTP参数污染漏洞，以便在应用程序仅允许使用一个折扣码时，能够应用多个折扣码。
  - 检查由于缺少输入清理而可能导致的安全漏洞，如XSS、SQL注入等。
  - 尝试通过操作服务器端请求，将折扣码应用于本不应享受折扣的商品。
- **配送费用操控**
  - 尝试使用负值作为配送费用，检验是否能够减少最终支付金额。
  - 评估是否可以通过修改参数来激活免费配送服务。
- **货币套利**
  - 尝试以一种货币（如美元）进行支付，而以另一种货币（如欧元）申请退款。利用汇率差可能获得利润。
- **高级功能利用**
  - 探索在无有效订阅的情况下，访问仅限高级会员的功能区域或端点。
  - 购买高级功能后取消订阅，检查是否能在退款后继续使用该功能。
  - 在请求/响应中寻找验证高级访问权限的真/假值。使用工具如Burp Suite的“匹配和替换”功能来篡改这些值，实现未经授权的高级访问。
  - 检查用于验证高级访问权限的cookie或本地存储变量。
- **退款功能利用**
  - 购买商品后申请退款，检查商品是否仍然可以使用。
  - 寻找货币套利的机会。
  - 针对订阅服务提交多次取消请求，检查是否能获得多次退款。
- **购物车/愿望清单利用**
  - 测试系统是否允许添加负数量的商品，结合其他商品来平衡总金额。
  - 尝试添加超过库存量的商品。
  - 检查愿望清单或购物车中的商品是否能被转移到其他用户的购物车中或被移除。
- **线程评论测试**
  - 检查对某一线程的评论数量是否有限制。
  - 如果用户只能评论一次，利用竞态条件尝试发布多条评论。
  - 如果系统允许已验证或特权用户评论，尝试模仿这些参数以测试是否可以同样评论。
  - 尝试冒充其他用户发布评论。
- **参数篡改**
  - 操纵支付或其他关键字段来改变它们的值。
  - 利用HTTP参数污染和批量赋值，添加额外或意外的字段。
  - 尝试操纵响应以绕过限制，例如两步验证（2FA）。

## 参考资料

- 业务逻辑漏洞 - OWASP
- 业务逻辑漏洞 - PortSwigger
- 业务逻辑漏洞示例 - PortSwigger